
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../stage-in/">
      
      
        <link rel="next" href="../staged/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>CWL CommandLineTool for stage-out - Mastering Earth Observation Application Packaging with CWL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/css/app.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Mastering Earth Observation Application Packaging with CWL" class="md-header__button md-logo" aria-label="Mastering Earth Observation Application Packaging with CWL" data-md-component="logo">
      
  <img src="../../imgs/icon-eoap.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Mastering Earth Observation Application Packaging with CWL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CWL CommandLineTool for stage-out
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Mastering Earth Observation Application Packaging with CWL" class="md-nav__button md-logo" aria-label="Mastering Earth Observation Application Packaging with CWL" data-md-component="logo">
      
  <img src="../../imgs/icon-eoap.png" alt="logo">

    </a>
    Mastering Earth Observation Application Packaging with CWL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prerequisites
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Prerequisites
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to YAML
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/cwl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to CWL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Earth Observation Application Package
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Earth Observation Application Package
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app-package/ogc-context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OGC Activities
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introducing the application
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Introducing the application
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/water-bodies-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Water bodies detection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Application Steps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Application Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_1" >
        
          
          <label class="md-nav__link" for="__nav_4_2_1" id="__nav_4_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Crop
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_1">
            <span class="md-nav__icon md-icon"></span>
            Crop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/crop/app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python-env/crop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the step
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Normalized Difference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Normalized Difference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/normalized-difference/app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python-env/norm-diff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the step
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Otsu threshold
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            Otsu threshold
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/otsu/app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python-env/otsu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the step
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    STAC Catalog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            STAC Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../app/stac/app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../python-env/stac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the step
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Package the EO Application
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Package the EO Application
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Creating the containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Creating the containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/scope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Build and test the containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Build and test the containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/crop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/norm-diff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normalized difference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/otsu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ostu threshold
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/stac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STAC Catalog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Create CWL CommandLineTools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Create CWL CommandLineTools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cwl-cli/scope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cwl-cli/crop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cwl-cli/norm-diff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Normalized difference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cwl-cli/otsu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ostu threshold
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cwl-cli/stac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STAC Catalog
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Create the CWL Workflows
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Create the CWL Workflows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloud-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentinel-2 Cloud native Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3_3" id="__nav_5_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Staged Landsat-9 Workflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_3_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3_3">
            <span class="md-nav__icon md-icon"></span>
            Staged Landsat-9 Workflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stage-in-out/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding stage-in/out
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stage-in/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CWL CommandLineTool for stage-in
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CWL CommandLineTool for stage-out
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../staged/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processing a staged Landsat-9 acquisition
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scatter-cloud-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentinel-2 Workflow of Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Release the EO Application
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Release the EO Application
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release/scope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release/ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Continuous Integration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Execution Scenarios
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Execution Scenarios
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exec/scope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running on a local machine
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Running on a local machine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exec-cloud-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentinel-2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exec-stage-in/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Landsat-9
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running CWL Workflow on Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Running CWL Workflow on Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/calrissian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run the CWL Workflow with calrissian
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scripting the execution
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Scripting the execution
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripted/scripted-cloud-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cwltool API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripted/scripted-k8s-cloud-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    calrissian API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmarking/calrissian-benchmark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application benchmarking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fair/best-practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAIR Application Packages
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/ogc-ap-bp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OGC Application Package Best Practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cwl-commandlinetool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CWL CommandLineTool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cwl-workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CWL Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_4" >
        
          
          <label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/cwltool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cwltool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/calrissian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    calrissian
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>CWL CommandLineTool for stage-out</h1>

<p>Below a <code>stage-out.cwl</code> CWL (Common Workflow Language) document for a command-line tool that executes a Python script. </p>
<p>The document is designed to use a container and execute a Python script named "stage.py":</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><span class="nt">cwlVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.0</span>
</span><span id="__span-0-2">
</span><span id="__span-0-3">
</span><span id="__span-0-4"><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CommandLineTool</span>
</span><span id="__span-0-5"><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stage-out</span>
</span><span id="__span-0-6">
</span><span id="__span-0-7"><span class="nt">doc</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Stage-out</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">results</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">S3&quot;</span>
</span><span id="__span-0-8"><span class="nt">inputs</span><span class="p">:</span>
</span><span id="__span-0-9"><span class="w">  </span><span class="nt">s3_bucket</span><span class="p">:</span>
</span><span id="__span-0-10"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-11"><span class="w">  </span><span class="nt">sub_path</span><span class="p">:</span>
</span><span id="__span-0-12"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-13"><span class="w">  </span><span class="nt">aws_access_key_id</span><span class="p">:</span>
</span><span id="__span-0-14"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-15"><span class="w">  </span><span class="nt">aws_secret_access_key</span><span class="p">:</span>
</span><span id="__span-0-16"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-17"><span class="w">  </span><span class="nt">region_name</span><span class="p">:</span>
</span><span id="__span-0-18"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-19"><span class="w">  </span><span class="nt">endpoint_url</span><span class="p">:</span>
</span><span id="__span-0-20"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-21"><span class="w">  </span><span class="nt">stac_catalog</span><span class="p">:</span>
</span><span id="__span-0-22"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Directory</span>
</span><span id="__span-0-23"><span class="nt">outputs</span><span class="p">:</span>
</span><span id="__span-0-24"><span class="w">  </span><span class="nt">s3_catalog_output</span><span class="p">:</span>
</span><span id="__span-0-25"><span class="w">    </span><span class="nt">outputBinding</span><span class="p">:</span>
</span><span id="__span-0-26"><span class="w">      </span><span class="nt">outputEval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${  return &quot;s3://&quot; + inputs.s3_bucket + &quot;/&quot; + inputs.sub_path + &quot;/catalog.json&quot;; }</span>
</span><span id="__span-0-27"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-28"><span class="nt">baseCommand</span><span class="p">:</span>
</span><span id="__span-0-29"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
</span><span id="__span-0-30"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stage.py</span>
</span><span id="__span-0-31"><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-0-32"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.stac_catalog.path )</span>
</span><span id="__span-0-33"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.s3_bucket )</span>
</span><span id="__span-0-34"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.sub_path )</span>
</span><span id="__span-0-35"><span class="nt">requirements</span><span class="p">:</span>
</span><span id="__span-0-36"><span class="w">  </span><span class="nt">DockerRequirement</span><span class="p">:</span>
</span><span id="__span-0-37"><span class="w">    </span><span class="nt">dockerPull</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/terradue/ogc-eo-application-package-hands-on/stage:1.3.2</span>
</span><span id="__span-0-38"><span class="w">  </span><span class="nt">InlineJavascriptRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-0-39"><span class="w">  </span><span class="nt">EnvVarRequirement</span><span class="p">:</span>
</span><span id="__span-0-40"><span class="w">    </span><span class="nt">envDef</span><span class="p">:</span>
</span><span id="__span-0-41"><span class="w">      </span><span class="nt">aws_access_key_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.aws_access_key_id )</span>
</span><span id="__span-0-42"><span class="w">      </span><span class="nt">aws_secret_access_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.aws_secret_access_key )</span>
</span><span id="__span-0-43"><span class="w">      </span><span class="nt">aws_region_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.region_name )</span>
</span><span id="__span-0-44"><span class="w">      </span><span class="nt">aws_endpoint_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$( inputs.endpoint_url )</span>
</span><span id="__span-0-45"><span class="w">  </span><span class="nt">ResourceRequirement</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-0-46"><span class="w">  </span><span class="nt">InitialWorkDirRequirement</span><span class="p">:</span>
</span><span id="__span-0-47"><span class="w">    </span><span class="nt">listing</span><span class="p">:</span>
</span><span id="__span-0-48"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">entryname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stage.py</span>
</span><span id="__span-0-49"><span class="w">        </span><span class="nt">entry</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
</span><span id="__span-0-50"><span class="hll"><span class="w">          </span><span class="no">import os</span>
</span></span><span id="__span-0-51"><span class="hll"><span class="w">          </span><span class="no">import sys</span>
</span></span><span id="__span-0-52"><span class="hll"><span class="w">          </span><span class="no">import pystac</span>
</span></span><span id="__span-0-53"><span class="hll"><span class="w">          </span><span class="no">import botocore</span>
</span></span><span id="__span-0-54"><span class="hll"><span class="w">          </span><span class="no">import boto3</span>
</span></span><span id="__span-0-55"><span class="hll"><span class="w">          </span><span class="no">import shutil</span>
</span></span><span id="__span-0-56"><span class="hll"><span class="w">          </span><span class="no">from pystac.stac_io import DefaultStacIO, StacIO</span>
</span></span><span id="__span-0-57"><span class="hll"><span class="w">          </span><span class="no">from urllib.parse import urlparse</span>
</span></span><span id="__span-0-58"><span class="hll">
</span></span><span id="__span-0-59"><span class="hll"><span class="w">          </span><span class="no">cat_url = sys.argv[1]</span>
</span></span><span id="__span-0-60"><span class="hll"><span class="w">          </span><span class="no">bucket = sys.argv[2]</span>
</span></span><span id="__span-0-61"><span class="hll"><span class="w">          </span><span class="no">subfolder = sys.argv[3]</span>
</span></span><span id="__span-0-62"><span class="hll">
</span></span><span id="__span-0-63"><span class="hll"><span class="w">          </span><span class="no">aws_access_key_id = os.environ[&quot;aws_access_key_id&quot;]</span>
</span></span><span id="__span-0-64"><span class="hll"><span class="w">          </span><span class="no">aws_secret_access_key = os.environ[&quot;aws_secret_access_key&quot;]</span>
</span></span><span id="__span-0-65"><span class="hll"><span class="w">          </span><span class="no">region_name = os.environ[&quot;aws_region_name&quot;]</span>
</span></span><span id="__span-0-66"><span class="hll"><span class="w">          </span><span class="no">endpoint_url = os.environ[&quot;aws_endpoint_url&quot;]</span>
</span></span><span id="__span-0-67"><span class="hll">
</span></span><span id="__span-0-68"><span class="hll"><span class="w">          </span><span class="no">shutil.copytree(cat_url, &quot;/tmp/catalog&quot;)</span>
</span></span><span id="__span-0-69"><span class="hll"><span class="w">          </span><span class="no">cat = pystac.read_file(os.path.join(&quot;/tmp/catalog&quot;, &quot;catalog.json&quot;))</span>
</span></span><span id="__span-0-70"><span class="hll">
</span></span><span id="__span-0-71"><span class="hll"><span class="w">          </span><span class="no">class CustomStacIO(DefaultStacIO):</span>
</span></span><span id="__span-0-72"><span class="hll"><span class="w">              </span><span class="no">&quot;&quot;&quot;Custom STAC IO class that uses boto3 to read from S3.&quot;&quot;&quot;</span>
</span></span><span id="__span-0-73"><span class="hll">
</span></span><span id="__span-0-74"><span class="hll"><span class="w">              </span><span class="no">def __init__(self):</span>
</span></span><span id="__span-0-75"><span class="hll"><span class="w">                  </span><span class="no">self.session = botocore.session.Session()</span>
</span></span><span id="__span-0-76"><span class="hll"><span class="w">                  </span><span class="no">self.s3_client = self.session.create_client(</span>
</span></span><span id="__span-0-77"><span class="hll"><span class="w">                      </span><span class="no">service_name=&quot;s3&quot;,</span>
</span></span><span id="__span-0-78"><span class="hll"><span class="w">                      </span><span class="no">use_ssl=True,</span>
</span></span><span id="__span-0-79"><span class="hll"><span class="w">                      </span><span class="no">aws_access_key_id=aws_access_key_id,</span>
</span></span><span id="__span-0-80"><span class="hll"><span class="w">                      </span><span class="no">aws_secret_access_key=aws_secret_access_key,</span>
</span></span><span id="__span-0-81"><span class="hll"><span class="w">                      </span><span class="no">endpoint_url=endpoint_url,</span>
</span></span><span id="__span-0-82"><span class="hll"><span class="w">                      </span><span class="no">region_name=region_name,</span>
</span></span><span id="__span-0-83"><span class="hll"><span class="w">                  </span><span class="no">)</span>
</span></span><span id="__span-0-84"><span class="hll">
</span></span><span id="__span-0-85"><span class="hll"><span class="w">              </span><span class="no">def write_text(self, dest, txt, *args, **kwargs):</span>
</span></span><span id="__span-0-86"><span class="hll"><span class="w">                  </span><span class="no">parsed = urlparse(dest)</span>
</span></span><span id="__span-0-87"><span class="hll"><span class="w">                  </span><span class="no">if parsed.scheme == &quot;s3&quot;:</span>
</span></span><span id="__span-0-88"><span class="hll"><span class="w">                      </span><span class="no">self.s3_client.put_object(</span>
</span></span><span id="__span-0-89"><span class="hll"><span class="w">                          </span><span class="no">Body=txt.encode(&quot;UTF-8&quot;),</span>
</span></span><span id="__span-0-90"><span class="hll"><span class="w">                          </span><span class="no">Bucket=parsed.netloc,</span>
</span></span><span id="__span-0-91"><span class="hll"><span class="w">                          </span><span class="no">Key=parsed.path[1:],</span>
</span></span><span id="__span-0-92"><span class="hll"><span class="w">                          </span><span class="no">ContentType=&quot;application/geo+json&quot;,</span>
</span></span><span id="__span-0-93"><span class="hll"><span class="w">                      </span><span class="no">)</span>
</span></span><span id="__span-0-94"><span class="hll"><span class="w">                  </span><span class="no">else:</span>
</span></span><span id="__span-0-95"><span class="hll"><span class="w">                      </span><span class="no">super().write_text(dest, txt, *args, **kwargs)</span>
</span></span><span id="__span-0-96"><span class="hll">
</span></span><span id="__span-0-97"><span class="hll">
</span></span><span id="__span-0-98"><span class="hll"><span class="w">          </span><span class="no">client = boto3.client(</span>
</span></span><span id="__span-0-99"><span class="hll"><span class="w">              </span><span class="no">&quot;s3&quot;,</span>
</span></span><span id="__span-0-100"><span class="hll"><span class="w">              </span><span class="no">aws_access_key_id=aws_access_key_id,</span>
</span></span><span id="__span-0-101"><span class="hll"><span class="w">              </span><span class="no">aws_secret_access_key=aws_secret_access_key,</span>
</span></span><span id="__span-0-102"><span class="hll"><span class="w">              </span><span class="no">endpoint_url=endpoint_url,</span>
</span></span><span id="__span-0-103"><span class="hll"><span class="w">              </span><span class="no">region_name=region_name,</span>
</span></span><span id="__span-0-104"><span class="hll"><span class="w">          </span><span class="no">)</span>
</span></span><span id="__span-0-105"><span class="hll">
</span></span><span id="__span-0-106"><span class="hll"><span class="w">          </span><span class="no">StacIO.set_default(CustomStacIO)</span>
</span></span><span id="__span-0-107"><span class="hll">
</span></span><span id="__span-0-108"><span class="hll"><span class="w">          </span><span class="no">for item in cat.get_items():</span>
</span></span><span id="__span-0-109"><span class="hll"><span class="w">              </span><span class="no">for key, asset in item.get_assets().items():</span>
</span></span><span id="__span-0-110"><span class="hll"><span class="w">                  </span><span class="no">s3_path = os.path.normpath(</span>
</span></span><span id="__span-0-111"><span class="hll"><span class="w">                      </span><span class="no">os.path.join(os.path.join(subfolder, item.id, asset.href))</span>
</span></span><span id="__span-0-112"><span class="hll"><span class="w">                  </span><span class="no">)</span>
</span></span><span id="__span-0-113"><span class="hll"><span class="w">                  </span><span class="no">print(f&quot;upload {asset.href} to s3://{bucket}/{s3_path}&quot;,file=sys.stderr)</span>
</span></span><span id="__span-0-114"><span class="hll"><span class="w">                  </span><span class="no">client.upload_file(</span>
</span></span><span id="__span-0-115"><span class="hll"><span class="w">                      </span><span class="no">asset.get_absolute_href(),</span>
</span></span><span id="__span-0-116"><span class="hll"><span class="w">                      </span><span class="no">bucket,</span>
</span></span><span id="__span-0-117"><span class="hll"><span class="w">                      </span><span class="no">s3_path,</span>
</span></span><span id="__span-0-118"><span class="hll"><span class="w">                  </span><span class="no">)</span>
</span></span><span id="__span-0-119"><span class="hll"><span class="w">                  </span><span class="no">asset.href = f&quot;s3://{bucket}/{s3_path}&quot;</span>
</span></span><span id="__span-0-120"><span class="hll"><span class="w">                  </span><span class="no">item.add_asset(key, asset)</span>
</span></span><span id="__span-0-121"><span class="hll">
</span></span><span id="__span-0-122"><span class="hll"><span class="w">          </span><span class="no">cat.normalize_hrefs(f&quot;s3://{bucket}/{subfolder}&quot;)</span>
</span></span><span id="__span-0-123"><span class="hll">
</span></span><span id="__span-0-124"><span class="hll"><span class="w">          </span><span class="no">for item in cat.get_items():</span>
</span></span><span id="__span-0-125"><span class="hll"><span class="w">              </span><span class="no"># upload item to S3</span>
</span></span><span id="__span-0-126"><span class="hll"><span class="w">              </span><span class="no">print(f&quot;upload {item.id} to s3://{bucket}/{subfolder}&quot;, file=sys.stderr)</span>
</span></span><span id="__span-0-127"><span class="hll"><span class="w">              </span><span class="no">pystac.write_file(item, item.get_self_href())</span>
</span></span><span id="__span-0-128"><span class="hll">
</span></span><span id="__span-0-129"><span class="hll"><span class="w">          </span><span class="no"># upload catalog to S3</span>
</span></span><span id="__span-0-130"><span class="hll"><span class="w">          </span><span class="no">print(f&quot;upload catalog.json to s3://{bucket}/{subfolder}&quot;, file=sys.stderr)</span>
</span></span><span id="__span-0-131"><span class="hll"><span class="w">          </span><span class="no">pystac.write_file(cat, cat.get_self_href())</span>
</span></span><span id="__span-0-132"><span class="hll">
</span></span><span id="__span-0-133"><span class="hll"><span class="w">          </span><span class="no">print(f&quot;s3://{bucket}/{subfolder}/catalog.json&quot;, file=sys.stdout)</span>
</span></span></code></pre></div></td></tr></table></div>
<p>The Python script <code>stage.py</code> uploads a Spatio-Temporal Asset Catalog (STAC) catalog to an Object Storage S3 bucket. 
This script utilizes the <code>boto3</code> library for the S3 operations and customizes the STAC I/O to read from and write to an S3 bucket.</p>
<p>Here's a breakdown of what the script does:</p>
<ul>
<li>
<p>The script imports necessary libraries and modules, including <code>os</code>, <code>sys</code>, <code>pystac</code>, <code>botocore</code>, <code>boto3</code>, <code>shutil</code>, and more.</p>
</li>
<li>
<p>It reads command-line arguments to get the STAC catalog URL, S3 bucket name, and a subfolder path to where the catalog will be uploaded.</p>
</li>
<li>
<p>It retrieves the S3 credentials and endpoint URL from environment variables.</p>
</li>
<li>
<p>The script copies the STAC catalog (from the given URL) to a temporary directory under "/tmp/catalog."</p>
</li>
<li>
<p>A custom STAC I/O class (<code>CustomStacIO</code>) is defined. This class extends the <code>DefaultStacIO</code> class and uses <code>boto3</code> to interact with S3. It has methods for writing STAC text content to S3.</p>
</li>
<li>
<p>A connection to S3 is established using <code>boto3</code> with the provided S3 credentials and endpoint URL.</p>
</li>
<li>
<p>The default STAC I/O class is set to the custom <code>CustomStacIO</code>.</p>
</li>
<li>
<p>The script iterates through items in the STAC catalog, including their assets. For each asset, it uploads the data to the specified S3 bucket under the given subfolder and updates the asset's href to the S3 location.</p>
</li>
<li>
<p>After uploading all assets, it normalizes the catalog's hrefs to point to the S3 location.</p>
</li>
<li>
<p>The script then uploads each item in the catalog to S3, updating their hrefs accordingly.</p>
</li>
<li>
<p>Finally, it uploads the catalog itself to S3.</p>
</li>
<li>
<p>The script prints the S3 URL of the uploaded catalog to the standard output.</p>
</li>
</ul>
<p>This script uploads a STAC catalog and its associated assets to an S3 bucket, making it accessible through the S3 endpoint. </p>
<p>It uses a custom STAC I/O to facilitate S3 interactions.</p>
<p>The AWS credentials and endpoint URL need to be properly configured in the environment variables for the script to work. A</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><span class="nb">export</span><span class="w"> </span><span class="nv">WORKSPACE</span><span class="o">=</span>/workspace/mastering-app-package
</span><span id="__span-1-2">
</span><span id="__span-1-3">podman<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-4"><span class="w">    </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-5"><span class="w">    </span>--format<span class="w"> </span>docker<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-6"><span class="w">    </span>-t<span class="w"> </span>localhost/stage:latest<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-7"><span class="w">    </span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/water-bodies/command-line-tools/stage
</span></code></pre></div></td></tr></table></div>
<p>To run the stage-out step, one would run:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1">cwltool<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><span class="w">    </span>--podman<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-3"><span class="w">    </span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/cwl-cli/stage-out.cwl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-4"><span class="w">    </span>--aws_access_key_id<span class="w"> </span><span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>~/.aws/credentials<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>aws_access_key_id<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-5"><span class="w">    </span>--aws_secret_access_key<span class="w"> </span><span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>~/.aws/credentials<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>aws_secret_access_key<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-6"><span class="w">    </span>--endpoint_url<span class="w"> </span><span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>~/.aws/config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>endpoint_url<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-7"><span class="w">    </span>--region_name<span class="w"> </span><span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>~/.aws/config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>region<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;=&quot;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-8"><span class="hll"><span class="w">    </span>--s3_bucket<span class="w"> </span>processing-results<span class="w"> </span><span class="se">\</span>
</span></span><span id="__span-2-9"><span class="hll"><span class="w">    </span>--sub_path<span class="w"> </span>processing-results/<span class="k">$(</span><span class="w"> </span>cat<span class="w"> </span>/proc/sys/kernel/random/uuid<span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span></span><span id="__span-2-10"><span class="hll"><span class="w">    </span>--stac_catalog<span class="w"> </span><span class="si">${</span><span class="nv">WORKSPACE</span><span class="si">}</span>/runs
</span></span></code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://img.shields.io/badge/License-CC_BY--SA_4.0-lightgrey.svg">License CC BY-SA 4.0</a>, by <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>