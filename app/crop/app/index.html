
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../water-bodies-detection/" rel="prev"/>
<link href="../../../python-env/crop/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.48" name="generator"/>
<title>Description - Mastering Earth Observation Application Packaging with CWL</title>
<link href="../../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../styles/css/app.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#step-purpose">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Mastering Earth Observation Application Packaging with CWL" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Mastering Earth Observation Application Packaging with CWL">
<img alt="logo" src="../../../imgs/icon-eoap.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Mastering Earth Observation Application Packaging with CWL
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Description
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Mastering Earth Observation Application Packaging with CWL" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Mastering Earth Observation Application Packaging with CWL">
<img alt="logo" src="../../../imgs/icon-eoap.png"/>
</a>
    Mastering Earth Observation Application Packaging with CWL
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Introduction
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Prerequisites
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Prerequisites
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../prerequisites/yaml/">
<span class="md-ellipsis">
    Introduction to YAML
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../prerequisites/cwl/">
<span class="md-ellipsis">
    Introduction to CWL
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Earth Observation Application Package
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Earth Observation Application Package
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../app-package/ogc-context/">
<span class="md-ellipsis">
    OGC Activities
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Introducing the application
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Introducing the application
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../water-bodies-detection/">
<span class="md-ellipsis">
    Water bodies detection
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    Application Steps
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Application Steps
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_1" id="__nav_4_2_1_label" tabindex="0">
<span class="md-ellipsis">
    Crop
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_2_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_1">
<span class="md-nav__icon md-icon"></span>
            Crop
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Description
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Description
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-purpose">
<span class="md-ellipsis">
      Step purpose
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code">
<span class="md-ellipsis">
      Code
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../python-env/crop/">
<span class="md-ellipsis">
    Running the step
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
<span class="md-ellipsis">
    Normalized Difference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_2">
<span class="md-nav__icon md-icon"></span>
            Normalized Difference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../normalized-difference/app/">
<span class="md-ellipsis">
    Description
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../python-env/norm-diff/">
<span class="md-ellipsis">
    Running the step
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
<span class="md-ellipsis">
    Otsu threshold
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_3">
<span class="md-nav__icon md-icon"></span>
            Otsu threshold
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../otsu/app/">
<span class="md-ellipsis">
    Description
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../python-env/otsu/">
<span class="md-ellipsis">
    Running the step
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
<span class="md-ellipsis">
    STAC Catalog
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_4">
<span class="md-nav__icon md-icon"></span>
            STAC Catalog
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../stac/app/">
<span class="md-ellipsis">
    Description
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../python-env/stac/">
<span class="md-ellipsis">
    Running the step
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Package the EO Application
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Package the EO Application
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    Creating the containers
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            Creating the containers
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../containers/scope/">
<span class="md-ellipsis">
    Scope
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
<span class="md-ellipsis">
    Build and test the containers
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_1_2">
<span class="md-nav__icon md-icon"></span>
            Build and test the containers
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../containers/crop/">
<span class="md-ellipsis">
    Crop
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../containers/norm-diff/">
<span class="md-ellipsis">
    Normalized difference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../containers/otsu/">
<span class="md-ellipsis">
    Ostu threshold
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../containers/stac/">
<span class="md-ellipsis">
    STAC Catalog
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    Create CWL CommandLineTools
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            Create CWL CommandLineTools
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-cli/scope/">
<span class="md-ellipsis">
    Scope
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-cli/crop/">
<span class="md-ellipsis">
    Crop
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-cli/norm-diff/">
<span class="md-ellipsis">
    Normalized difference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-cli/otsu/">
<span class="md-ellipsis">
    Ostu threshold
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-cli/stac/">
<span class="md-ellipsis">
    STAC Catalog
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    Create the CWL Workflows
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            Create the CWL Workflows
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/scope/">
<span class="md-ellipsis">
    Scope
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/cloud-native/">
<span class="md-ellipsis">
    Sentinel-2 Cloud native Workflow
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3_3" id="__nav_5_3_3_label" tabindex="0">
<span class="md-ellipsis">
    Staged Landsat-9 Workflow
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_3_3">
<span class="md-nav__icon md-icon"></span>
            Staged Landsat-9 Workflow
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/stage-in-out/">
<span class="md-ellipsis">
    Understanding stage-in/out
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/stage-in/">
<span class="md-ellipsis">
    CWL CommandLineTool for stage-in
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/stage-out/">
<span class="md-ellipsis">
    CWL CommandLineTool for stage-out
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/staged/">
<span class="md-ellipsis">
    Processing a staged Landsat-9 acquisition
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/scatter-cloud-native/">
<span class="md-ellipsis">
    Sentinel-2 Workflow of Workflow
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Release the EO Application
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Release the EO Application
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../release/scope/">
<span class="md-ellipsis">
    Scope
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../release/ci/">
<span class="md-ellipsis">
    Continuous Integration
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Execution Scenarios
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Execution Scenarios
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../exec/scope/">
<span class="md-ellipsis">
    Scope
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
<span class="md-ellipsis">
    Running on a local machine
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
            Running on a local machine
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/exec-cloud-native/">
<span class="md-ellipsis">
    Sentinel-2
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cwl-workflow/exec-stage-in/">
<span class="md-ellipsis">
    Landsat-9
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
<span class="md-ellipsis">
    Running CWL Workflow on Kubernetes
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
            Running CWL Workflow on Kubernetes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../kubernetes/calrissian/">
<span class="md-ellipsis">
    Run the CWL Workflow with calrissian
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
<span class="md-ellipsis">
    Scripting the execution
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_4">
<span class="md-nav__icon md-icon"></span>
            Scripting the execution
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../scripted/scripted-cloud-native/">
<span class="md-ellipsis">
    cwltool API
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../scripted/scripted-k8s-cloud-native/">
<span class="md-ellipsis">
    calrissian API
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../benchmarking/calrissian-benchmark/">
<span class="md-ellipsis">
    Application benchmarking
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../fair/best-practice/">
<span class="md-ellipsis">
    FAIR Application Packages
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Reference
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/ogc-ap-bp/">
<span class="md-ellipsis">
    OGC Application Package Best Practice
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/cwl-commandlinetool/">
<span class="md-ellipsis">
    CWL CommandLineTool
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/cwl-workflow/">
<span class="md-ellipsis">
    CWL Workflow
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_9_4" id="__nav_9_4_label" tabindex="0">
<span class="md-ellipsis">
    Tools
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_9_4">
<span class="md-nav__icon md-icon"></span>
            Tools
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/cwltool/">
<span class="md-ellipsis">
    cwltool
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/calrissian/">
<span class="md-ellipsis">
    calrissian
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-purpose">
<span class="md-ellipsis">
      Step purpose
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#code">
<span class="md-ellipsis">
      Code
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1>Description</h1>
<h3 id="step-purpose">Step purpose</h3>
<p>Purpose: to crop a particular band defined as a common band name (such as the "green" or "nir" band) from a satellite image acquired by either Sentinel-2 or Landsat-9. </p>
<p>This step is highlighted below:</p>
<div class="mermaid">graph TB
style B stroke:#f66,stroke-width:3px
style C stroke:#f66,stroke-width:3px
subgraph Process STAC item
  A[STAC Item] == STAC Item URL ==&gt; B
  A[STAC Item] == STAC Item URL ==&gt; C
  A[STAC Item] -.-&gt; F
subgraph scatter on bands
  B["crop(green)"];
  C["crop(nir)"];
end
  B["crop(green)"] == crop_green.tif ==&gt; D[Normalized difference];
  C["crop(nir)"] == crop_green.tif ==&gt; D[Normalized difference];
  D -.-&gt; E[Otsu threshold]
end
  E -.-&gt; F[Create STAC Catalog]
  F -.-&gt; G[(storage)]</div>
<h3 id="code">Code</h3>
<p>The <code>crop.py</code> script is a command-line tool that takes as input</p>
<ul>
<li>a SpatioTemporal Asset Catalog (STAC) Item</li>
<li>a bounding box area of interest (AOI), an EPSG code</li>
<li>a common band name as input</li>
</ul>
<p>and then crops the specified band from the asset associated with the common band name to the specified AOI. </p>
<p>It uses various Python libraries like <code>pystac</code>, <code>rasterio</code>, <code>pyproj</code>, <code>shapely</code>, and <code>loguru</code>.</p>
<p>Here is an overview of the script's functionality:</p>
<ul>
<li>
<p>It defines a function <code>aoi2box</code> to convert an AOI expressed as a bounding box string into a list of floats.</p>
</li>
<li>
<p>It defines a function <code>get_asset</code> to retrieve the asset of a STAC Item that is defined with a common band name. It iterates through the assets and checks if a band has the specified common name.</p>
</li>
<li>
<p>It defines a command-line interface using <code>click</code>, with options for providing the input STAC Item URL, AOI, EPSG code, and common band name.</p>
</li>
<li>
<p>The <code>crop</code> function is the main entry point. It reads the STAC Item specified by the input URL and retrieves the asset associated with the common band name. It then crops the asset to the specified AOI using the rasterio library.</p>
</li>
<li>
<p>It transforms the bounding box coordinates to match the EPSG code provided.</p>
</li>
<li>
<p>It performs the cropping using the <code>rasterio.mask.mask</code> function.</p>
</li>
<li>
<p>It writes the cropped image to a GeoTIFF file with a filename like "crop_bandname.tif."</p>
</li>
</ul>
<p>The script is executable as a command-line tool as its usage is:</p>
<div class="highlight"><pre><span></span><code><span id="__span-0-1">Usage: app.py [OPTIONS]
</span><span id="__span-0-2">
</span><span id="__span-0-3">  Crops a STAC Item asset defined with its common band name
</span><span id="__span-0-4">
</span><span id="__span-0-5">Options:
</span><span id="__span-0-6">  --input-item TEXT  STAC Item URL or staged STAC catalog  [required]
</span><span id="__span-0-7">  --aoi TEXT         Area of interest expressed as a bounding box  [required]
</span><span id="__span-0-8">  --epsg TEXT        EPSG code  [required]
</span><span id="__span-0-9">  --band TEXT        Common band name  [required]
</span><span id="__span-0-10">  --help             Show this message and exit.
</span></code></pre></div>
<p>To use this script, you would typically run it from the command line, providing the necessary input options such as the STAC Item URL, AOI, EPSG code, and common band name: </p>
<div class="highlight"><pre><span></span><code><span id="__span-1-1">python app.py \
</span><span id="__span-1-2">  --input-item "https://earth-search.aws.element84.com/v0/collections/sentinel-s2-l2a-cogs/items/S2B_10TFK_20210713_0_L2A" \
</span><span id="__span-1-3">  --aoi "-121.399,39.834,-120.74,40.472" \
</span><span id="__span-1-4">  --epsg "EPSG:4326" \
</span><span id="__span-1-5">  --band "green" 
</span></code></pre></div>
<p>It will then crop the specified band from the STAC asset and save it as a GeoTIFF file.</p>
<p>The Python code is provided here:</p>
<div class="highlight"><table class="highlighttable"><tr><th class="filename" colspan="2"><span class="filename">water-bodies/command-line-tools/crop/app.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><span class="kn">import</span> <span class="nn">os</span>
</span><span id="__span-2-2"><span class="kn">import</span> <span class="nn">click</span>
</span><span id="__span-2-3"><span class="kn">import</span> <span class="nn">pystac</span>
</span><span id="__span-2-4"><span class="kn">import</span> <span class="nn">rasterio</span>
</span><span id="__span-2-5"><span class="kn">from</span> <span class="nn">rasterio.mask</span> <span class="kn">import</span> <span class="n">mask</span>
</span><span id="__span-2-6"><span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Transformer</span>
</span><span id="__span-2-7"><span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">box</span>
</span><span id="__span-2-8"><span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>
</span><span id="__span-2-9">
</span><span id="__span-2-10">
</span><span id="__span-2-11"><span class="k">def</span> <span class="nf">aoi2box</span><span class="p">(</span><span class="n">aoi</span><span class="p">):</span>
</span><span id="__span-2-12"><span class="w">    </span><span class="sd">"""Converts an area of interest expressed as a bounding box to a list of floats"""</span>
</span><span id="__span-2-13">    <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">aoi</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)]</span>
</span><span id="__span-2-14">
</span><span id="__span-2-15">
</span><span id="__span-2-16"><span class="k">def</span> <span class="nf">get_asset</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">common_name</span><span class="p">):</span>
</span><span id="__span-2-17"><span class="w">    </span><span class="sd">"""Returns the asset of a STAC Item defined with its common band name"""</span>
</span><span id="__span-2-18">    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">get_assets</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-2-19">        <span class="k">if</span> <span class="ow">not</span> <span class="s2">"data"</span> <span class="ow">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s2">"roles"</span><span class="p">]:</span>
</span><span id="__span-2-20">            <span class="k">continue</span>
</span><span id="__span-2-21">
</span><span id="__span-2-22">        <span class="n">eo_asset</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">eo</span><span class="o">.</span><span class="n">AssetEOExtension</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
</span><span id="__span-2-23">        <span class="k">if</span> <span class="ow">not</span> <span class="n">eo_asset</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
</span><span id="__span-2-24">            <span class="k">continue</span>
</span><span id="__span-2-25">        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">eo_asset</span><span class="o">.</span><span class="n">bands</span><span class="p">:</span>
</span><span id="__span-2-26">            <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-2-27">                <span class="s2">"common_name"</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="__span-2-28">                <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">"common_name"</span><span class="p">]</span> <span class="o">==</span> <span class="n">common_name</span>
</span><span id="__span-2-29">            <span class="p">):</span>
</span><span id="__span-2-30">                <span class="k">return</span> <span class="n">asset</span>
</span><span id="__span-2-31">
</span><span id="__span-2-32">
</span><span id="__span-2-33"><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">(</span>
</span><span id="__span-2-34">    <span class="n">short_help</span><span class="o">=</span><span class="s2">"Crop"</span><span class="p">,</span>
</span><span id="__span-2-35">    <span class="n">help</span><span class="o">=</span><span class="s2">"Crops a STAC Item asset defined with its common band name"</span><span class="p">,</span>
</span><span id="__span-2-36"><span class="p">)</span>
</span><span id="__span-2-37"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-2-38">    <span class="s2">"--input-item"</span><span class="p">,</span>
</span><span id="__span-2-39">    <span class="s2">"item_url"</span><span class="p">,</span>
</span><span id="__span-2-40">    <span class="n">help</span><span class="o">=</span><span class="s2">"STAC Item URL or staged STAC catalog"</span><span class="p">,</span>
</span><span id="__span-2-41">    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-42"><span class="p">)</span>
</span><span id="__span-2-43"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-2-44">    <span class="s2">"--aoi"</span><span class="p">,</span>
</span><span id="__span-2-45">    <span class="s2">"aoi"</span><span class="p">,</span>
</span><span id="__span-2-46">    <span class="n">help</span><span class="o">=</span><span class="s2">"Area of interest expressed as a bounding box"</span><span class="p">,</span>
</span><span id="__span-2-47">    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-48"><span class="p">)</span>
</span><span id="__span-2-49"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-2-50">    <span class="s2">"--epsg"</span><span class="p">,</span>
</span><span id="__span-2-51">    <span class="s2">"epsg"</span><span class="p">,</span>
</span><span id="__span-2-52">    <span class="n">help</span><span class="o">=</span><span class="s2">"EPSG code"</span><span class="p">,</span>
</span><span id="__span-2-53">    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-54"><span class="p">)</span>
</span><span id="__span-2-55"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span id="__span-2-56">    <span class="s2">"--band"</span><span class="p">,</span>
</span><span id="__span-2-57">    <span class="s2">"band"</span><span class="p">,</span>
</span><span id="__span-2-58">    <span class="n">help</span><span class="o">=</span><span class="s2">"Common band name"</span><span class="p">,</span>
</span><span id="__span-2-59">    <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-60"><span class="p">)</span>
</span><span id="__span-2-61"><span class="k">def</span> <span class="nf">crop</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">epsg</span><span class="p">):</span>
</span><span id="__span-2-62">
</span><span id="__span-2-63">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">item_url</span><span class="p">):</span>
</span><span id="__span-2-64">        <span class="n">catalog</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item_url</span><span class="p">,</span> <span class="s2">"catalog.json"</span><span class="p">))</span>
</span><span id="__span-2-65">        <span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">get_items</span><span class="p">())</span>
</span><span id="__span-2-66">    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-2-67">        <span class="n">item</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">item_url</span><span class="p">)</span>
</span><span id="__span-2-68">
</span><span id="__span-2-69">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Read </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">get_self_href</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-2-70">
</span><span id="__span-2-71">    <span class="n">asset</span> <span class="o">=</span> <span class="n">get_asset</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
</span><span id="__span-2-72">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Read asset </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">get_absolute_href</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-2-73">
</span><span id="__span-2-74">    <span class="k">if</span> <span class="ow">not</span> <span class="n">asset</span><span class="p">:</span>
</span><span id="__span-2-75">        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Common band name </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2"> not found in the assets"</span>
</span><span id="__span-2-76">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-2-77">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-2-78">
</span><span id="__span-2-79">    <span class="n">bbox</span> <span class="o">=</span> <span class="n">aoi2box</span><span class="p">(</span><span class="n">aoi</span><span class="p">)</span>
</span><span id="__span-2-80">
</span><span id="__span-2-81">    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">get_absolute_href</span><span class="p">())</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
</span><span id="__span-2-82">
</span><span id="__span-2-83">        <span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">epsg</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-2-84">
</span><span id="__span-2-85">        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-2-86">        <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-2-87">
</span><span id="__span-2-88">        <span class="n">transformed_bbox</span> <span class="o">=</span> <span class="n">box</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>
</span><span id="__span-2-89">
</span><span id="__span-2-90">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Crop </span><span class="si">{</span><span class="n">asset</span><span class="o">.</span><span class="n">get_absolute_href</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-2-91">
</span><span id="__span-2-92">        <span class="n">out_image</span><span class="p">,</span> <span class="n">out_transform</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span>
</span><span id="__span-2-93">            <span class="n">src</span><span class="p">,</span> <span class="p">[</span><span class="n">transformed_bbox</span><span class="p">],</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-2-94">        <span class="p">)</span>
</span><span id="__span-2-95">        <span class="n">out_meta</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-2-96">
</span><span id="__span-2-97">        <span class="n">out_meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-2-98">            <span class="p">{</span>
</span><span id="__span-2-99">                <span class="s2">"height"</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="__span-2-100">                <span class="s2">"width"</span><span class="p">:</span> <span class="n">out_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="__span-2-101">                <span class="s2">"transform"</span><span class="p">:</span> <span class="n">out_transform</span><span class="p">,</span>
</span><span id="__span-2-102">                <span class="s2">"dtype"</span><span class="p">:</span> <span class="s2">"uint16"</span><span class="p">,</span>
</span><span id="__span-2-103">                <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"COG"</span><span class="p">,</span>
</span><span id="__span-2-104">                <span class="s2">"tiled"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-2-105">                <span class="s2">"compress"</span><span class="p">:</span> <span class="s2">"lzw"</span><span class="p">,</span>
</span><span id="__span-2-106">                <span class="s2">"blockxsize"</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
</span><span id="__span-2-107">                <span class="s2">"blockysize"</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
</span><span id="__span-2-108">            <span class="p">}</span>
</span><span id="__span-2-109">        <span class="p">)</span>
</span><span id="__span-2-110">
</span><span id="__span-2-111">        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">"crop_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="o">**</span><span class="n">out_meta</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst_dataset</span><span class="p">:</span>
</span><span id="__span-2-112">            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Write crop_</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">.tif"</span><span class="p">)</span>
</span><span id="__span-2-113">            <span class="n">dst_dataset</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_image</span><span class="p">)</span>
</span><span id="__span-2-114">
</span><span id="__span-2-115">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Done!"</span><span class="p">)</span>
</span><span id="__span-2-116">
</span><span id="__span-2-117">
</span><span id="__span-2-118"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-2-119">    <span class="n">crop</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
<a href="https://img.shields.io/badge/License-CC_BY--SA_4.0-lightgrey.svg">License CC BY-SA 4.0</a>, by <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="../../../javascripts/config.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.6.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>